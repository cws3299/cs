### 브라우저 작동원리



#### :computer: 브라우저의 주요기능

- <b>선택한 자원을 서버에게 요청하고, 전송받은 자원을 브라우저 화면에 표시</b>
- <b>자원의 종류</b> : HTML , CSS ,  JavaScript, PDF, Image, 기타 등등

![20210610_211001](C:\Users\cws89\Documents\cs\웹\브라우저 작동원리\20210610_211001.png)

- <b>그렇다면 브라우저는 자원을 어떻게 요청하는가?</b>
  - `URI (Uniform Resource Identifier)`라는 자원의 주소를 기반으로 자원을 요청한다
  - `URI를 통한 자원 요청 방법은 `
    - url을 통한 요청, api를 통한 데이터 요청 , aws s3의 엔드포인트 등 다양하게 존재
  - :bulb: 한가지 예시​ 
    - 우리가 브라우저에 www.naver.com을 입력한다.
    - 입력 후 해당 주소에 맞는 페이지를 보여주기 위해 다양한 자원을 네이버 서버에 요청하고 해당 자원을 받는다.
    - 이 상황에서 www.naver.com은 <B>URI</B>가 되며 페이지를 불러오기 위해 받은 모든 파일들은 자원이 된다.



#### :computer: 브라우저의 호환성

- 브라우저는 HTML과 CSS같은 프로그래밍 언어 뿐만 아니라 , 이미지 혹은 동영상 파일도 브라우저에서 바로 표현을 할 수 있다.
- 이렇게 다양한 데이터 형태가 상호작용 가능한 이유는 <B>웹 표준</B>을 미리 정해 놓았기 때문이다.
- 웹 표준이란 <B>웹에서 표준적으로 사용되는 기술이나 규칙</B>을 의미한다.



#### :computer: 브라우저의 기본 구조

![20210610_211841](C:\Users\cws89\Documents\cs\웹\브라우저 작동원리\20210610_211841.png)



브라우저의 기본구조는 위의 사진과 같다.



##### 사용자 인터페이스

- 브라우저에서 요청한 자원 및 페이지를 보여주는 화면을 제외한 모든 부문을 말한다.
- 예를 들면 / 뒤로가기,앞으로가기 버튼 , 주소입력창 등





##### 브라우저 엔진

- <b>사용자 인터페이스와 렌더링 엔진 사이의 동작을 제어</b>
- 브라우저 엔진은 `브라우저 자체에 동작하는 소프트웨어 엔진` 
- 사용자 인터페이스 - `브라우저 엔진` - 렌더링 엔진



##### 통신

- HTTP 요청과 같은 네트워크 호출을 하는 브라우저 내부 계층



##### 자바스크립트 해석기

- 자바스크립트 코드 해석



##### UI백엔드

- 기본적인 UI장치들을 의미한다. 
- 예를들어 우리가 만든 사이트의 코드는 다양한 CSS적 모습으로 구성되어져 있는데 UI백엔드는 이에 맞추어 그림을 그린다.



##### 자료저장소

- 웹 브라우저 내에서 사용되는 자료 저장 계층으로, 우리가 흔히 아는 `쿠키` , `웹 스토리지`등을 예로 들수 있다



##### 렌더링 엔진

- 렌더링 엔진은 요청받은 자원을 브라우저 화면에 표시하는 작업을 한다.
- 렌더링 엔진은 여러종류가 있지만 대표적으로 `Webkit`과 `Gecko`를 예로 들 수 있다.



##### 렌더링 엔진 동작 과정

- 렌더링 엔진은 통신으로부터 요청받은 문서의 내용을 얻은 후 시작된다.

![20210610_212710](C:\Users\cws89\Documents\cs\웹\브라우저 작동원리\20210610_212710.png)



##### HTML 파싱

- 어휘분석 : 의미 없는 공백과 줄 바꿈을 제거하고 의미있는 문자 단위로 분해하는 과정
- 구문분석 : 언어의 구문 규칙을 적용하는 과정
- 파싱작업의 경우 <B>렌더링 엔진이 스스로 하는 것이 아니라 파서라는 녀석이 한다</B>
- <B>파서는 파서 생성기에 의해서 만들어 진다.</B>
- <B>파서 생성기</B> : 각 프로그래밍 언어를 파싱하기 위해서 만들어낸 도구 `대표적으로 UNIX에는 Lex와 Yacc이 존재함`
- 크롬과 사파리의 경우 어휘 분석의 경우 `플렉스(Flex)`를 사용하고 문법의 경우 `바이슨(Bison)`을 사용한다. 
- Flex와 Bison은 Lex와 Yacc을 토대로 구현됬다
- 웹킷에서는 단순히 두 생성기에서 나온 파서를 이용하여 CSS와 JavaScript를 파싱한다.
- 모든 전통적인 파서는 HTML을 파싱할 수 없다.
- 그 이유는 HTML은 <B>문맥 자유 문법</B>이 아니기 때문이다. 즉 HTML은 문법에 오류가 존재해도 코드가 수행된다는 것을 의미한다.
- HTML의 경우 HTML전용 파서가 존재한다. 이는 `Webkit`과 `Gecko`의 프레임워크 안에 존재하기도 한다.



##### DTD 

- 해당 단계를 거쳐야 DOM Tree단계에 진입할 수 있다.



##### DOM

- <b>DOM은 HTML 문서의 객체들을 표현하며 외부를 향하는 자바스크립트와 같은 HTML요소의 연결지점이다.</b>

- <B>HTML 문서에 작성한 문자열 내용들을 브라우저에서 사용할 수 있는 Object 객체 데이터로 형상회 한 것</B>

- HTML : HTML 파일 안에 형식에 맞게 작성된 문자열 텍스트

- DOM : 해당 HTML의 텍스트에 맞춰서 생성된 객체 데이터

- '외부를 향하는 자바스크립트와 같은 HTML요소의 연결지점'이다 라는 의미는

- ```javascript
  const element = document.getElementById('name'); // <- DOM 접근
  element.innerHTML = 'hello~Inyong'; // 접근한 DOM 내부를 HTML Document 형태로 렌더링
  // 이 뿐 아니라 appendChild, removeChild 등 DOM API로 조작이 가능.
  ```

- 위 내용을 보면 쉽게 이해가능

- DOM은 HTML 마크업과 1:1 관계를 맺으므로 ,  HTMP문서에 작성된 모든 요소가 DOM으로 생성된다.

- 완성된 Dom-Tree를 기반으로 Render Tree를 생성해야 하는데 , 이를 위해 css가 파싱된 Style Sheet가 필요하다.



##### CSS파싱

- CSS 파싱에는 `Internal`, `Inline` ,`External` 방식이 존재함

- 앞의 두 방법의 경우 HTMLstyleElement라는 Dom객체로 변환되어 Dom Tree에 추가되고 external방식의 경우 HTMLlinkElement라는 DOM객체로 변환되어 추가됨

- HTMLstyleElement의 경우 추가될 시 바로 컴파일 되지만 HTMLlinkElement는 Link로 연관된 리소스 파일을 전부 받아온 후 컴파일이 실행됨

- 그러나 자바스크립트 파일이 없을 경우 속도 차이는 존재하지 않음, 그러나 자바스크립트 파일이 존재할 경우 느려짐

- HTML 문서를 파싱하던 중 자바스크립트 파일을 만나면 자바스크립트를 먼저 실행한다. 자바스크립트가 CSS보다 우선순위에 존재하기 때문

- Flex와 Bison을 통해 파싱을 하면 DOM과 결합하여 별도의 CSSOM이라는 스타일 관련 객체모델이 생성된다. CSSOM은 HTML의 DOM과 같이 스타일 객체에 접근할 수 있는 인터페이스 객체가 된다.

- ```javascript
  const element = document.getElementById('inyong');
  element.style.color = 'green'; // <= 해당 DOM의 CSSOM에 접근하여 스타일 변경.
  ```



##### RenderTree

- 파싱 작업들이 끝나면 `attechment`라는 작업을 수행하고 실제 화면에 그려질 Render Tree를 생성함
- RenderTree와 DomTree는 1대1로 대응되지 않음
  - RenderTree의 경우 비시각적인 요소는 렌더안함
  - 특정 요소에는 여러번의 렌더가 필요하다.



##### 배치

- render가 완료되면 이후 페이지 배치가 발생한다.
- render된 내용들의 위치를 계산하는 과정
- 어떻게 그려질지는 정해졌으나 어디에 그려질지는 정해지지 않았음 : 이를 결정하는 단계
- 전역배치
  - 모든 렌더링에 영향을 주는 전역 스타일 변경이 발생할 때 일어나는 배치 : 동기
- 점증배치
  - 더티 렌더를 통해 변경할 특정 렌더를 찾아 변경시킴 : 비동기



##### 그림 그리기



래퍼런스

https://helloinyong.tistory.com/286 : 너무 감사합니다!!!!