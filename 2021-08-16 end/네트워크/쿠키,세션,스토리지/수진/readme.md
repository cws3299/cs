# 쿠키(cookie) / 세션(session) / 웹 스토리지(Web Storage)

> HTTP 프로토콜에는 비연결성과 비상태성이라는 특징이 있다. 이는 서버의 자원을 절약하기 위해 모든 사용자의 요청마다 연결과 해제의 과정을 거치기 때문에 연결 상태가 유지되지 않고, 연결 해제 후에 상태 정보가 저장되지 않는다. 이로 인해 같은 사용자가 요청을 여러번 하더라도 매번 새로운 사용자로 인식하는 단점이 있다. 이를 보완하여 서버가 클라이언트를 식별하게 해주는 것이 쿠키와 세션이다.

### 1. 쿠키

#### 1.1 쿠키의 개념

- 쿠키는 웹 사이트에 접속할 때 생성되는 정보를 담은 임시 파일
- 서버가 사용자의 웹 브라우저에 저장하는 데이터
- 서버를 대신해서 이러한 정보들을 웹 브라우저에 저장하고 사용자가 요청을  할때 그 정보를 함께 보내서 서버가 사용자를 식별할 수 있게 해줌.

#### 1.2 쿠키의 사용목적

- 세션관리 : 로그인, 사용자 닉네임, 접속 시간, 장바구니 등의 서버가 알아야할 정보들을 저장
- 개인화 : 사용자마다 다르게 그 사람에 적절할 페이지를 보여줄 수 있다.
- 트래킹 : 사용자의 행동과 패턴을 본석하고 기록

#### 1.3 쿠키 프로세스

- 브라우저에 웹페이지 접속
- 클라이언트가 요청한 웹페이지를 받으면서 쿠키를 클라이언트 로컬에 저장
- 클라이언트가 재 요청시 웹페이지 요청과 함께 쿠키값도 전송
- 지속적으로 로그인 정보를 가지고 있는 것처럼 사용

#### 1.4 쿠키가 사용되는 예시

> 쿠키가 있기 때문에 로그인을 유지하고 상요자 정보를 유지 할 수 있다. 

- ID저장, 로그인 상태 유지
- 일주일간 다시 보지 않기
- 최근 검색한 상품들을 광고에서 추천
- 쇼핑몰 장바구니 기능 등

#### 1.5 쿠키의 단점

- 방문기록 및 개인정보가 기록되기 때문에 사생활 침해할 소지가 있음, 이를 해소하기 위해 웹 브라우저 자체에 쿠키 거부 기능이 있다. 
- 서버가 아닌 사용자에게 저장되기 때문에, 임의로 수정 및 삭제가 가능하고 보안이 취약하다. 따라서 쿠키에는 민감정보를 담는 것은 위험하다. 이를 보완하는 것이 세션이다.



### 2. 세션

#### 2.1 세션의 개념

- 일정 시간 동안 같은 브라우저로부터 들어오는 일련의 요구를 하나의 상태로 보고 그 상태를 유지하는 기술

- 쿠키를 기반으로 하지만 사용자 정보 파일을 브라우저에 저장하는 쿠키와 달리 서버 측에서 관리한다.
- 클라이언트가 Request를 보내면, 해당 서버의 엔진이 클라이언트에게 유일한 ID를 부여하는 데 이것이 세션 ID이다. 
- 서버에서는 클라이언트를 구분하기 위해 세션 ID를 부여하여 웹 브라우저가 서버에 접속해서 브라우저를 종료할 때까지 인증상태를 유지

#### 2.2 세션의 특징

- 각 클라이언트에게 고유ID를 부여
- 세션 ID로 클라이언트를 구분해서 클라이언트의 요구에 맞는 서비스를 제공
- 쿠키보다 보안에 좋지만, 사용자가 많아질수록 서버 메모리를 많이 차지하게 된다. 
- 즉, 동접자 수가 많은 웹 사이트인 경우 서버에 과부하를 주게 되므로 성능 저하의 요인이 된다. 

#### 2.3 세션의 프로세스

- 클라이언트가 서버에 접속시 세션 ID를 발급
- 서버에는 클라이언트로 발급해준 세선 ID를 쿠키에 저장
- 클라이언트는 다시 접속할 때, 이 쿠키를 이용해서 세션ID값을 서버에 전달

=> 즉, 세션을 구별하기 위해 ID가 필요하고 이 ID만 쿠키를 이용해 저장. 쿠키는 자동으로 서버에 전송되고 서버에서 세션 아이디에 따른 처리를 할 수 있다.

(EX 게시판에 글을 작성하면 세션에 있는 아이디를 참조해서 작성자를 지정하게 한다.)

#### 2.4 세션이 사용되는 예시

- 로그인 정보 유지(화면이동시에도 로그인이 풀리지 않고 로그아웃하기 전까지 유지)



### 3. 쿠키와 세션의 차이

|          | Cookie                                                | Session       |
| -------- | ----------------------------------------------------- | ------------- |
| 저장위치 | 클라이언트                                            | 서버          |
| 저장형식 | text                                                  | object        |
| 리소스   | 클라이언트의 리소스                                   | 서버의 리소스 |
| 용량제한 | 도메인당 20개, 1쿠키당 4KB                            | 제한 없음     |
| 만료시점 | 쿠키 저장시 설정(설정 없는 경우 브라우저 종류시 만료) | 알 수 없음    |
| 속도     | 세션보다 빠름                                         | 쿠키보다 느림 |
| 보안     | 세션보다 안좋음                                       | 쿠키보다 좋음 |

- 쿠키와 세션은 비슷한 역할을 하며, 동작원리 비슷하다. 세션도 결국 쿠키를 사용하기 때문이다.

- 서버의 자원을 활용에 따라 사용자의 정보가 저장되는 위치가 다르다.

- 세션이 보안성이 더 우수하며, 요청 속도는 쿠키가 세션보다 더 빠르다. 그 이유는 세션은 서버의 처리가 필요하기 때문이다.

- 쿠키도 만료시간이 있지만 파일로 저장되기 때문에 브라우저를 종료해도 계속해서 정보가 남아 있을 수 있다. 만료기간을 넉넉하게 잡아두면 쿠키삭제를 할 때 까지 유지될 수도 있다.

- 반면, 세션도 만료시간을 정할 수 있지만, 브라우저가 종료되면 만료시간에 상관없이 삭제된다.

  

### 4. 세션이 아닌 쿠키를 사용하는 이유

> 세션은 서버의 자원을 사용하기 때문에 무분별하게 만들다보면 메모리가 감당할 수 없어질 수 있고 속도가 느려지기 때문이다.



### 5. 웹 스토리지

#### 5.1 웹 스토리지와 쿠키

- 웹 스토리지는 서버가 아닌, 클라이언트에 데이터를 저장할 수 있도록 하는 기능이다.
- 쿠키와 기능 자체는 유사하지만, 쿠키는 약 4KB밖에 저장 공간을 이용하지 못하는 반면 웹 스토리지는 약 5MB까지 저장공간을 이용가능하다.

#### 5.2 로컬 스토리지

- 브라우저에 반영구적으로 데이터를 저장하고 브라우저를 종료해도 데이터가 유지된다. 하지만 도메인이 다른 경우 로컬 스토리지에 접근 할 수 없다.

- 예를 들어 `www.asdf.com`에서 로컬 스토리지에 저장한 데이터를 `www.qwert.com`에서 접근할 수 없는 것과 같다. 

- 사용법

  ```
  localStorage.setItem('item',10); // 10을 item이라는 이름으로 저장
  console.log(localStorage.getItem('item')); item에 저장된 10 출력
  ```

#### 5.3 세션 스토리지

- 각 세션마다 데이터가 개별적으로 저장된다.
- 브라우저에서 여러개의 탭을 실행하면 탭마다 개별적으로 데이터가 저장되는 것이다.
- 세션 스토리지는 로컬 스토리지와 다르게 세션을 종료하면 데이터가 자동으로 제거되고 같은 도메인이라도 세션이 다르면 데이터에 접근할 수 없다.
- 사용법은 로컬스토리지와 동일하다.





[참고]

- https://devuna.tistory.com/23

- https://interconnection.tistory.com/74

- https://untitledtblog.tistory.com/47